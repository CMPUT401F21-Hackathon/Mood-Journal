{% extends 'base.html' %}

{% load static %}

{% block title %}Home{% endblock %}

{% block content %}
<style type="text/css">
  .image-container{
    max-width: 250px;
    height: auto;
    position: relative;
  }
</style>
{% if user.is_authenticated %}

  <div class="jumbotron text-center" style="margin-bottom:0">
    <small>Welcome to </small>
    <h1>Moodie</h1>
    <!-- <p>Resize this responsive page to see the effect!</p>  -->
  </div>

  <nav class="navbar navbar-expand-sm bg-dark navbar-dark ">
    <a class="navbar-brand" href="#"></a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="collapsibleNavbar">
      <ul class="navbar-nav mx-auto">
        <li class="nav-item">
          <a class="nav-link" href="{% url 'mood_journal:mood_new' %}">New Mood</a>
        </li>
      </ul>
    </div>  
  </nav>

  <div class="container" style="margin-top:30px">
    <div class="row">
      <div class="col-sm-4">
        <h2>{{user.username}}</h2>
        <div class = "profile-picture " id = "id_image_container">
          <input class="d-none" type="file" id="id_real_image">
          <img  id = "id_profile_image_display" src="{% static 'img/generic_profile_picture.PNG' %}" alt="Profile Picture" width="130" height="130"/>
        </div>

        <p>Some text about me in culpa qui officia deserunt mollit anim..</p>
        <h3><p><a href="{% url 'mood_journal:edit_profile' %}">Edit Profile</a></p></h3>
        <p>Lorem ipsum dolor sit ame.</p>
        <ul class="nav nav-pills flex-column">
          <li class="nav-item">
            <a class="nav-link active" href="#">Active</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Link</a>
          </li>
        </ul>
        <hr class="d-sm-none">
      </div>
      <div class="col-sm-8">
        <h2>Graph</h2>
        <div class="chart-area">
          <canvas id="my-chart"></canvas>
        </div>
        <br>

        {% for mood in moods %}
        <div class="mood-box">
          <h2>Mood <a href="/mood/{{mood.id}}/">{{mood.id}}</a></h2>
          <h5>Date: {{mood.timestamp}}</h5>
          <p>Score: {{mood.score}}</p>
          <p>Recomendation: {{mood.recommendation}}</p>
          <p>Link: <a href={{mood.link}}>{{mood.link_title}}</a></p>
        </div>
          <br>
        {% endfor %}
      </div>
    </div>
  </div>


  <div class="jumbotron text-center" style="margin-bottom:0">
    <p>Footer</p>
  </div>


  <script language="JavaScript">
    var config = {
      type: 'line',
      data: {
        labels: {{ labels|safe }},
        datasets: [{
          label: "Happiness",
          lineTension: 0.3,
          backgroundColor: "rgba(78, 115, 223, 0.05)",
          borderColor: "rgba(78, 115, 223, 1)",
          pointRadius: 3,
          pointBackgroundColor: "rgba(78, 115, 223, 1)",
          pointBorderColor: "rgba(78, 115, 223, 1)",
          pointHoverRadius: 3,
          pointHoverBackgroundColor: "rgba(78, 115, 223, 1)",
          pointHoverBorderColor: "rgba(78, 115, 223, 1)",
          pointHitRadius: 10,
          pointBorderWidth: 2,
          data: {{ data|safe }}
        }],
      },
      options: {
        responsive: true
      }
    };

    window.onload = function() {
      var ctx = document.getElementById("my-chart").getContext('2d');
      window.myChart = new Chart(ctx, config);
    };
  </script>

<script language="JavaScript">
  
  editPic()

  function readURL(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();

            reader.onload = function (e) {
            	disableImageOverlay()
            	var image = e.target.result
            	var imageField = document.getElementById('id_profile_image_display')
                imageField.src = image
            };

            reader.readAsDataURL(input.files[0]);
        }
    }

  function editPic(){

    const realImageFile = document.getElementById("id_real_image");

    const profileImage = document.getElementById("id_profile_image_display")
    profileImage.style.opacity = "1"
    profileImage.style.display = "block"
    profileImage.style.width = "100%"
    profileImage.style.height = "auto"
    profileImage.style.transition = ".5s ease"
    profileImage.style.backfaceVisibility  = "hidden"
    profileImage.style.cursor = "pointer"

    const imageContainer = document.getElementById("id_image_container")
    imageContainer.addEventListener("mouseover", function(event) { 
      profileImage.style.opacity = "0.3"
      middleContainer.style.opacity = "1"
    })

    imageContainer.addEventListener("mouseout", function(event) { 
      profileImage.style.opacity = "1"
      middleContainer.style.opacity = "0"
    })

    imageContainer.addEventListener("click", function(){
      realImageFile.click();
    });

    realImageFile.addEventListener("change", function(){
      const choosedFile = this.files[0];
      if (choosedFile) {
        const reader = new FileReader();
        reader.addEventListener("load", function(){
          profileImage.setAttribute("src", reader.result);
        });
        reader.readAsDataURL(choosedFile);
      }
    });
  }
  
</script>

  <br></br>
  
  <p><a href="{% url 'logout' %}">Log Out</a></p>
{% else %}
  <p>You are not logged in</p>
  <a href="{% url 'login' %}">Log In</a>
{% endif %}
{% endblock %}